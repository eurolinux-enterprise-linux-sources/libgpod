<?xml version="1.0"?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN" 
               "http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd">
<refentry id="libgpod-File-handling-functions">
<refmeta>
<refentrytitle role="top_of_page">File handling functions</refentrytitle>
<manvolnum>3</manvolnum>
<refmiscinfo>LIBGPOD Library</refmiscinfo>
</refmeta>

<refnamediv>
<refname>File handling functions</refname>
<refpurpose>Managing files on the iPod</refpurpose>
<!--[<xref linkend="desc" endterm="desc.title"/>]-->
</refnamediv>

<refsynopsisdiv role="synopsis">
<title role="synopsis.title">Synopsis</title>

<synopsis>



<link linkend="gboolean">gboolean</link>            <link linkend="itdb-cp-track-to-ipod">itdb_cp_track_to_ipod</link>               (<link linkend="Itdb-Track">Itdb_Track</link> *track,
                                                         const <link linkend="gchar">gchar</link> *filename,
                                                         <link linkend="GError">GError</link> **error);
<link linkend="void">void</link>                <link linkend="itdb-filename-fs2ipod">itdb_filename_fs2ipod</link>               (<link linkend="gchar">gchar</link> *filename);
<link linkend="void">void</link>                <link linkend="itdb-filename-ipod2fs">itdb_filename_ipod2fs</link>               (<link linkend="gchar">gchar</link> *ipod_file);
<link linkend="gchar">gchar</link>*              <link linkend="itdb-filename-on-ipod">itdb_filename_on_ipod</link>               (<link linkend="Itdb-Track">Itdb_Track</link> *track);
<link linkend="gint">gint</link>                <link linkend="itdb-musicdirs-number">itdb_musicdirs_number</link>               (<link linkend="Itdb-iTunesDB">Itdb_iTunesDB</link> *itdb);
<link linkend="gboolean">gboolean</link>            <link linkend="itdb-rename-files">itdb_rename_files</link>                   (const <link linkend="gchar">gchar</link> *mp,
                                                         <link linkend="GError">GError</link> **error);
</synopsis>
</refsynopsisdiv>









<refsect1 role="desc">
<title role="desc.title">Description</title>
<para>
These functions are for copying, renaming, and retrieving information
about the files and directories on the iPod.
</para>
</refsect1>

<refsect1 role="details">
<title role="details.title">Details</title>
<refsect2>
<title><anchor id="itdb-cp-track-to-ipod" role="function"/>itdb_cp_track_to_ipod ()</title>
<indexterm><primary>itdb_cp_track_to_ipod</primary></indexterm><programlisting><link linkend="gboolean">gboolean</link>            itdb_cp_track_to_ipod               (<link linkend="Itdb-Track">Itdb_Track</link> *track,
                                                         const <link linkend="gchar">gchar</link> *filename,
                                                         <link linkend="GError">GError</link> **error);</programlisting>
<para>
Copy one track to the iPod. The PC filename is <parameter>filename</parameter>
and is taken literally.
</para>
<para>
The mountpoint of the iPod (in local encoding) must have been set
with <link linkend="itdb-set-mountpoint"><function>itdb_set_mountpoint()</function></link> (done automatically when reading an
iTunesDB).
</para>
<para>
If <parameter>track->transferred</parameter> is set to TRUE, nothing is done. Upon
successful transfer <parameter>track->transferred</parameter> is set to TRUE.
</para>
<para>
For storage, the directories "F00 ... Fnn" will be used randomly.
</para>
<para>
The filename is constructed as "libgpod<parameter>random_number</parameter>" and copied
to <parameter>track->ipod_path</parameter>. If this file already exists, <parameter>random_number</parameter>
is adjusted until an unused filename is found.
</para>
<para>
If <parameter>track->ipod_path</parameter> is already set, this one will be used
instead. If a file with this name already exists, it will be
overwritten.
</para>
<para>
<parameter>track->filetype_marker</parameter> is set according to the filename extension</para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>track</parameter>&nbsp;:</term>
<listitem><simpara>      the <link linkend="Itdb-Track"><type>Itdb_Track</type></link> to copy (containing <parameter>filename</parameter> metadata)
</simpara></listitem></varlistentry>
<varlistentry><term><parameter>filename</parameter>&nbsp;:</term>
<listitem><simpara>   the source file
</simpara></listitem></varlistentry>
<varlistentry><term><parameter>error</parameter>&nbsp;:</term>
<listitem><simpara>      return location for a <link linkend="GError"><type>GError</type></link> or NULL
</simpara></listitem></varlistentry>
<varlistentry><term><emphasis>Returns</emphasis>&nbsp;:</term><listitem><simpara> TRUE on success, FALSE on error, in which case <parameter>error</parameter> is
set accordingly.
</simpara></listitem></varlistentry>
</variablelist></refsect2>
<refsect2>
<title><anchor id="itdb-filename-fs2ipod" role="function"/>itdb_filename_fs2ipod ()</title>
<indexterm><primary>itdb_filename_fs2ipod</primary></indexterm><programlisting><link linkend="void">void</link>                itdb_filename_fs2ipod               (<link linkend="gchar">gchar</link> *filename);</programlisting>
<para>
Convert string from casual PC file name to iPod iTunesDB format
using ':' instead of G_DIR_SEPARATOR_S (i.e. slashes on Unix-like
systems). <parameter>ipod_file</parameter> is modified in place.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>filename</parameter>&nbsp;:</term>
<listitem><simpara> a 'PC-style' filename (eg /iPod_Control/Music/f00/test.mp3)
</simpara></listitem></varlistentry>
</variablelist></refsect2>
<refsect2>
<title><anchor id="itdb-filename-ipod2fs" role="function"/>itdb_filename_ipod2fs ()</title>
<indexterm><primary>itdb_filename_ipod2fs</primary></indexterm><programlisting><link linkend="void">void</link>                itdb_filename_ipod2fs               (<link linkend="gchar">gchar</link> *ipod_file);</programlisting>
<para>
Convert string from from iPod iTunesDB format to casual PC file
name using G_DIR_SEPARATOR (ie slashes on Unix-like systems)
instead of ':'.  <parameter>ipod_file</parameter> is modified in place.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>ipod_file</parameter>&nbsp;:</term>
<listitem><simpara> a 'PC-style' filename (eg /iPod_Control/Music/f00/test.mp3)
</simpara></listitem></varlistentry>
</variablelist></refsect2>
<refsect2>
<title><anchor id="itdb-filename-on-ipod" role="function"/>itdb_filename_on_ipod ()</title>
<indexterm><primary>itdb_filename_on_ipod</primary></indexterm><programlisting><link linkend="gchar">gchar</link>*              itdb_filename_on_ipod               (<link linkend="Itdb-Track">Itdb_Track</link> *track);</programlisting>
<para>
Get the full iPod filename as stored in <parameter>track</parameter>.
</para>
<para>
<note>
NULL is returned when the file does not exist.
</note>
</para>
<para>
<note>
This code works around a problem on some systems (see
<link linkend="itdb-resolve-path"><function>itdb_resolve_path()</function></link>) and might return a filename with different
case than the original filename. Don't copy it back to <parameter>track</parameter> if
you can avoid it.
</note></para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>track</parameter>&nbsp;:</term>
<listitem><simpara> an <link linkend="Itdb-Track"><type>Itdb_Track</type></link>
</simpara></listitem></varlistentry>
<varlistentry><term><emphasis>Returns</emphasis>&nbsp;:</term><listitem><simpara> full filename to <parameter>track</parameter> on the iPod or NULL if no
filename is set in <parameter>track</parameter>. Must be freed with <link linkend="g-free"><function>g_free()</function></link> after use.
</simpara></listitem></varlistentry>
</variablelist></refsect2>
<refsect2>
<title><anchor id="itdb-musicdirs-number" role="function" condition="since:0.1.3"/>itdb_musicdirs_number ()</title>
<indexterm role="0.1.3"><primary>itdb_musicdirs_number</primary></indexterm><programlisting><link linkend="gint">gint</link>                itdb_musicdirs_number               (<link linkend="Itdb-iTunesDB">Itdb_iTunesDB</link> *itdb);</programlisting>
<para>
Determine the number of F.. directories in iPod_Control/Music.
</para>
<para>
If <parameter>itdb->musicdirs</parameter> is already set, simply return the previously
determined number. Otherwise count the directories first and set
<parameter>itdb->musicdirs</parameter>.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>itdb</parameter>&nbsp;:</term>
<listitem><simpara> an <link linkend="Itdb-iTunesDB"><type>Itdb_iTunesDB</type></link>
</simpara></listitem></varlistentry>
<varlistentry><term><emphasis>Returns</emphasis>&nbsp;:</term><listitem><simpara> max number of directories in iPod_Control/Music

</simpara></listitem></varlistentry>
</variablelist><para role="since">Since  0.1.3
</para></refsect2>
<refsect2>
<title><anchor id="itdb-rename-files" role="function"/>itdb_rename_files ()</title>
<indexterm><primary>itdb_rename_files</primary></indexterm><programlisting><link linkend="gboolean">gboolean</link>            itdb_rename_files                   (const <link linkend="gchar">gchar</link> *mp,
                                                         <link linkend="GError">GError</link> **error);</programlisting>
<para>
Renames/removes some files on the iPod (Playcounts, OTG
semaphore). May have to be called if you write the iTunesDB not
directly to the iPod but to some other location and then manually
copy the file from there to the iPod.</para>
<para>

</para><variablelist role="params">
<varlistentry><term><parameter>mp</parameter>&nbsp;:</term>
<listitem><simpara>     mount point of the iPod
</simpara></listitem></varlistentry>
<varlistentry><term><parameter>error</parameter>&nbsp;:</term>
<listitem><simpara>  return location for a <link linkend="GError"><type>GError</type></link> or NULL
</simpara></listitem></varlistentry>
<varlistentry><term><emphasis>Returns</emphasis>&nbsp;:</term><listitem><simpara> FALSE on error and sets <parameter>error</parameter> accordingly
</simpara></listitem></varlistentry>
</variablelist></refsect2>

</refsect1>





<refsect1><refsect2 /><refsect2 /></refsect1>
</refentry>
